<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reproductor de Bucle para Museo</title>
    <!-- Carga de Tailwind CSS para un diseño moderno y responsive -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        /* Estilos personalizados para asegurar que el video cubra toda la pantalla */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #000; /* Fondo negro para evitar bordes */
            margin: 0;
            overflow: hidden; /* Evita barras de desplazamiento */
            display: flex;
            justify-content: center;
            align-items: center;
        }
        #videoPlayer {
            /* Asegura que el video cubra toda el área del viewport. 
               object-fit: cover recorta el video si es necesario para cubrir sin deformar. */
            min-width: 100vw;
            min-height: 100vh;
            width: auto;
            height: auto;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10;
        }
        .controls-overlay {
            z-index: 20;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: rgba(0, 0, 0, 0.7); /* Fondo oscuro para el estado inicial */
            transition: opacity 0.3s ease-in-out;
        }
    </style>
</head>
<body class="antialiased">

    <!-- Elemento de Video: Importante: Autoplay y Loop configurados aquí -->
    <video id="videoPlayer" class="hidden" autoplay loop playsinline>
        <!-- Fuente del video se establecerá mediante JavaScript -->
        Su navegador no soporta la etiqueta de video.
    </video>

    <!-- Overlay de Carga/Inicio -->
    <div id="initialOverlay" class="controls-overlay">
        <div class="p-8 bg-gray-800 rounded-xl shadow-2xl text-white max-w-lg text-center">
            <h1 class="text-3xl font-extrabold mb-4">Reproductor de Video para Bucle</h1>
            <p class="mb-6 text-gray-300">Selecciona el archivo de video (MP4/WebM) que deseas reproducir en bucle continuo.</p>
            
            <!-- Input de archivo oculto que se activa con el botón -->
            <input type="file" id="videoFile" accept="video/mp4,video/webm" class="hidden" onchange="loadVideo(event)">
            
            <button onclick="document.getElementById('videoFile').click()" 
                    class="w-full py-3 px-6 bg-indigo-600 hover:bg-indigo-700 text-white font-bold rounded-lg shadow-lg transition duration-150 ease-in-out transform hover:scale-105">
                Seleccionar Video
            </button>
            <p id="errorMsg" class="mt-4 text-red-400 font-semibold hidden"></p>
        </div>
    </div>

    <!-- Botón de Control (Visible una vez que el video está cargado) -->
    <button id="fullscreenBtn" 
            class="hidden fixed bottom-4 right-4 p-3 bg-gray-800 text-white rounded-full shadow-lg hover:bg-gray-600 transition duration-150"
            onclick="toggleFullscreen()" title="Pantalla Completa">
        <!-- Icono SVG de Pantalla Completa (Lucide icon: maximize) -->
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/></svg>
    </button>


    <script>
        const videoPlayer = document.getElementById('videoPlayer');
        const initialOverlay = document.getElementById('initialOverlay');
        const errorMsg = document.getElementById('errorMsg');
        const fullscreenBtn = document.getElementById('fullscreenBtn');

        const loadVideo = (event) => {
            const file = event.target.files[0];
            if (!file || !file.type.startsWith('video/')) {
                errorMsg.textContent = "Por favor, selecciona un archivo de video válido.";
                errorMsg.classList.remove('hidden');
                return;
            }

            // Oculta el mensaje de error si existe
            errorMsg.classList.add('hidden');
            
            // Crea una URL de objeto para el archivo seleccionado
            const videoURL = URL.createObjectURL(file);
            
            // Asigna la URL al reproductor de video
            videoPlayer.src = videoURL;
            
            // Muestra el reproductor y oculta la superposición de inicio
            videoPlayer.classList.remove('hidden');
            initialOverlay.style.opacity = '0'; // Animación de desvanecimiento
            
            // Una vez que la animación termina, oculta completamente el overlay
            setTimeout(() => {
                initialOverlay.classList.add('hidden');
                fullscreenBtn.classList.remove('hidden');
            }, 300);

            // Intentar reproducir el video (necesario por las políticas de autoplay)
            videoPlayer.play().catch(error => {
                console.error("Error al intentar auto-reproducir:", error);
                // Si falla la reproducción automática (ej: en móvil), informamos al usuario.
                // En este caso, el usuario ya ha interactuado, pero es una buena práctica.
            });
        };

        const toggleFullscreen = () => {
            if (!document.fullscreenElement) {
                // Entra en pantalla completa
                if (videoPlayer.requestFullscreen) {
                    videoPlayer.requestFullscreen();
                } else if (videoPlayer.webkitRequestFullscreen) { /* Safari */
                    videoPlayer.webkitRequestFullscreen();
                } else if (videoPlayer.msRequestFullscreen) { /* IE11 */
                    videoPlayer.msRequestFullscreen();
                }
            } else {
                // Sale de pantalla completa
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                } else if (document.webkitExitFullscreen) { /* Safari */
                    document.webkitExitFullscreen();
                } else if (document.msExitFullscreen) { /* IE11 */
                    document.msExitFullscreen();
                }
            }
        };

        // Escucha eventos del video para asegurar la reproducción
        videoPlayer.onloadeddata = () => {
            console.log("Video cargado y listo para reproducir.");
        };

        // Manejo del bucle: aunque el atributo 'loop' lo maneja, este código asegura la fluidez en algunos casos
        videoPlayer.onended = () => {
            videoPlayer.currentTime = 0;
            videoPlayer.play().catch(e => console.error("Error al reiniciar el bucle:", e));
        };

        // Nota importante: Para que el video tenga sonido en un entorno de museo,
        // asegúrate de que el volumen del dispositivo esté alto y el video original tenga audio.
        // Las políticas de los navegadores a veces restringen la reproducción automática con sonido.
        // Como el usuario debe seleccionar el archivo, ya hay una interacción, lo que suele permitir el audio.

    </script>
</body>
</html>